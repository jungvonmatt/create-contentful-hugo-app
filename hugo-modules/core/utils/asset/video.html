{{/*
  utils/asset/video
  Render Contentful asset (video/...). Uses data from cssg-plugin-assets if available.

  @example - Go Template
    {{- partial "utils/asset/video" (dict
      "context" $video
      "options" (dict
        "loop" false
        "muted" false
        "autoplay" false
        "class_name" "c-video"
      )
    ) -}}
*/}}
{{- $globals := .globals -}}
{{- $context := .context | default dict -}}
{{- $options := .options | default dict -}}
{{- $params := (merge $context $options) -}}
{{- $mime_type := $params.mime_type -}}
{{- $class_name := $params.class_name -}}
{{- $url := $params.src | default $params.url -}}
{{- $width := $params.width -}}
{{- $height := $params.height -}}
{{- $loop := $params.loop | default true -}}
{{- $autoplay := $params.autoplay | default true -}}
{{- $playsinline := $params.playsinline | default true -}}
{{- $controls := $params.controls | default false -}}
{{/* Use transparent base64, the real poster should be loaded as <picture> element */}}
{{- $poster := "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" -}}
{{- $muted := (or $autoplay $params.muted) -}}
{{- $loading := cond (eq ($params.lazy | default true) true) "lazy" ($params.loading | default false) -}}
{{- $preload := $params.preload | default false -}}
{{- $media := $params.media -}}

{{- $attributes := partialCached "utils/html/attribute" (dict
  "loop" $loop
  "autoplay" $autoplay
  "muted" $muted
  "controls" $controls
  "class" $class_name
  "poster" $poster
  "loading" $loading
) $params -}}

{{- if in $mime_type "video" -}}
  <video {{$attributes}}{{- if eq $loading "lazy" -}} data-video{{- end -}}>
    {{- if eq $loading "lazy" -}}
      <source data-src="{{- $url -}}" type="{{- $mime_type -}}" />
    {{- else -}}
      <source src="{{- $url -}}" type="{{- $mime_type -}}" />
    {{- end -}}
  </video>
{{- end -}}
